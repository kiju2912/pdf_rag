
# PDF 기반 RAG 파이프라인 및 클러스터링 기반 비텍스트 요소 추출 시스템

이 프로젝트는 PDF 문서 내의 텍스트와 비텍스트(이미지, 도형 등) 정보를 효과적으로 추출 및 분석하여, 질문-응답 시스템(Retrieval Augmented Generation, RAG) 및 이미지 캡셔닝 기능과 통합한 플랫폼입니다. 특히, 기존 OCR 방식이 아닌 자체 개발한 클러스터링 기법을 통해 PDF의 비텍스트 요소를 데이터 값으로 추출하고, 이를 벡터 스토어 및 SQL 데이터베이스에 저장하여 활용하는 점이 주요 특징입니다.

---

## 주요 특징

- **PDF 업로드 및 처리**  
  - **Flask 웹 인터페이스**를 통해 사용자가 PDF 파일을 업로드하면, 파일을 지정된 폴더에 저장한 후 내부의 텍스트와 비텍스트 요소를 추출합니다.
  - **자체 개발한 c.py 모듈**을 사용해 PDF 내의 비텍스트 요소(이미지, 드로잉 등)를 좌표 기반으로 추출하고, 인접한 요소들을 클러스터링 및 그룹화하여 하나의 영역으로 병합합니다.
  - 이 과정에서 각 클러스터 영역은 별도의 PDF 및 PNG 파일로 저장되며, 해당 정보는 SQL 데이터베이스에 기록되어 추후 분석 및 검색에 활용됩니다.

- **텍스트 및 캡션 분석**  
  - PDF 문서의 텍스트 블록을 분석하여 캡션(예: Figure, Table)을 검출하고, 캡션 영역과 비텍스트 클러스터 영역을 1:1 매칭하는 DFS 기반의 매칭 알고리즘을 적용합니다.
  - 추출된 캡션과 영역은 시각적으로 PDF 파일 내에 표시되며, 최종 결과물이 클러스터링 및 캡션 정보를 포함한 PDF로 생성됩니다.

- **RAG 파이프라인 및 질문-응답 기능**  
  - LangChain과 Milvus 벡터 스토어를 활용하여 PDF 내 텍스트 및 추가 문서(캡션, 비텍스트 영역 정보)를 임베딩하고, 사용자의 자연어 질문에 대해 관련 문맥을 검색하여 응답을 생성합니다.
  - HuggingFace의 언어 모델(예: mistralai/Mixtral-8x7B-Instruct-v0.1)을 통해 질문에 대한 답변을 생성하며, PDF 내 Figure 및 클러스터 영역 정보와 매칭된 결과를 제공합니다.

- **이미지 캡셔닝**  
  - Salesforce의 BLIP 모델을 활용하여 PNG 이미지 파일에 대해 자동 캡션을 생성합니다.
  - 이미지 캡셔닝 결과는 추출된 비텍스트 영역의 시각적 정보를 보완하는 역할을 하며, SQL에 저장된 메타데이터와 함께 관리됩니다.

---

## 시스템 구성

- **백엔드**  
  - **Flask**: 웹 서버 및 파일 업로드, 세션 관리, 채팅(질문-응답) 인터페이스 제공
  - **MySQL**: PDF 문서 및 캡션, 영역 정보 저장
  - **Milvus**: 임베딩 벡터를 저장하고 유사도 검색을 지원하는 벡터 스토어

- **PDF 처리 및 비텍스트 추출 (c.py)**  
  - **PyMuPDF(fitz)**: PDF 파일의 읽기 및 조작, 이미지/도형 영역 추출
  - **https://github.com/kiju2912/pdf_parser**:  
    - 텍스트 블록 분석, 캡션(figure/table) 검출  
    - 비텍스트 요소의 클러스터링 및 그룹화 (인접 요소 합치기, 겹침 영역 처리 등)
    - 클러스터 영역과 캡션 매칭, 별도 PDF/PNG 파일 저장 및 SQL 저장

- **자연어 처리 및 RAG (lang_pipe_line.py) 파이프라인**  
  - **LangChain**: 질문-응답 체인 구성 및 문서 청킹
  - **HuggingFace 모델**: 언어 모델을 통한 응답 생성 (예: Mixtral-8x7B-Instruct-v0.1[docling])

- **이미지 캡셔닝 (image_caption.py)**  
  - **BLIP 모델 (Salesforce)**: 이미지 캡션 자동 생성
  - **ThreadPoolExecutor**: 다중 이미지 병렬 처리

---

## 스크린샷

아래 스크린샷은 시스템의 주요 처리 결과 및 UI 구성 예시를 보여줍니다.

![스크린샷 1](./스크린샷_2025-03-27_오후_4.13.14.png)
![스크린샷 2](./스크린샷_2025-03-27_오후_4.13.30.png)
![스크린샷 3](./스크린샷_2025-03-27_오후_4.32.38.png)
![스크린샷 4](./스크린샷_2025-03-27_오후_4.32.56.png)
![스크린샷 5](./스크린샷_2025-03-27_오후_4.33.03.png)
![스크린샷 6](./스크린샷_2025-03-27_오후_4.33.31.png)
![스크린샷 7](./스크린샷_2025-03-27_오후_4.33.59.png)
![스크린샷 8](./스크린샷_2025-03-27_오후_4.34.09.png)
![스크린샷 9](./스크린샷_2025-03-27_오후_4.35.39.png)

---

## 설치 및 실행 방법

1. **환경 설정 및 의존성 설치**  
   - Python 3.x 환경에서 가상환경을 생성한 후, 아래와 같이 필요한 패키지를 설치합니다.
     ```bash
     pip install flask flask-cors mysql-connector-python python-dotenv pymupdf pillow transformers langchain
     ```
   - Milvus 서버와 MySQL 데이터베이스가 사전에 설치 및 설정되어 있어야 합니다.
   - HuggingFace API 토큰 및 기타 환경 변수는 `.env` 파일에 설정합니다.

2. **프로젝트 실행**  
   - **Flask 웹 서버 실행 (PDF 업로드 및 질문-응답 기능):**
     ```bash
     flask run --debug
     ```
   - **PDF 처리 파이프라인 실행 (c.py 모듈):**  
     - `python app.py` 또는 `python c.py` (메인 함수 호출)을 통해 데이터 폴더 내 PDF 파일들을 처리하고, 결과물을 `output/pdf` 및 `output/png`에 저장합니다.
   - **이미지 캡셔닝 테스트:**  
     ```bash
     python image_caption.py
     ```

3. **사용 방법**  
   - 웹 브라우저에서 Flask 앱의 기본 URL에 접속하여 PDF 파일을 업로드합니다.
   - 업로드된 PDF 파일은 내부의 텍스트와 비텍스트 요소가 처리된 후, 클러스터링된 영역 및 캡션 정보를 포함한 PDF와 PNG 파일로 저장됩니다.
   - SQL 데이터베이스에 PDF, 캡션 및 영역 정보가 저장되어 추후 벡터 스토어(또는 RAG 파이프라인)에서 활용됩니다.
   - 채팅 인터페이스를 통해 사용자가 질문하면, RAG 파이프라인이 PDF 내 관련 문맥을 검색하여 자연어 응답을 제공합니다.

---

## 향후 개선 방향

- **질문-응답 모델의 정밀도 향상**  
  - 더 강력한 언어 모델 및 프롬프트 튜닝을 통해 응답의 정확도와 관련성을 높임.
  
- **UI/UX 개선**  
  - 사용자 친화적인 프론트엔드 인터페이스 및 실시간 결과 표시 기능 추가.
  
- **다양한 문서 포맷 지원**  
  - PDF 외 다른 문서 포맷 지원 및 다양한 데이터 소스 연동.
  
- **클러스터링 알고리즘 최적화**  
  - 비텍스트 요소의 클러스터링 및 매칭 알고리즘 개선을 통한 처리 속도 및 정확도 향상.
  
- **시스템 배포**  
  - Docker 컨테이너화 및 클라우드 환경으로의 배포를 통한 운영 효율성 강화.

---

## 결론

이 프로젝트는 전통적인 OCR 방식에 의존하지 않고, PDF 문서 내의 비텍스트 요소를 클러스터링과 그룹화를 통해 구조적으로 추출하는 새로운 접근법을 제시합니다. 텍스트와 비텍스트 정보를 통합 관리함으로써, 학술 논문이나 복잡한 문서의 내용을 심층적으로 분석하고, 자연어 질문-응답 시스템 및 이미지 캡셔닝 기능과 결합하여 더욱 풍부한 정보를 제공합니다. 이를 통해 포트폴리오 및 연구 데모로 활용할 수 있는 강력한 문서 분석 플랫폼을 구현하였습니다.
EOF
